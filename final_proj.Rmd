---
title: "Final Project"
author: "Anish Shenoy, Jae Yoon Kim"
date: "11/25/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(rstanarm)
```

### Import and Merge data

First, import the First Street Foundation (FSF) Flood Risk Summary Statistics by zip
found here: https://registry.opendata.aws/fsf-flood-risk/?fbclid=IwAR2JUyZWXcXiKdXuXMXON-1VmcUm6RpCnUVXMiydCrrDCaXHg41zdkD-iI8
``` {r echo=TRUE, message=FALSE}
zip_risk <- read_csv("data/fsf/v1.1/Zip_level_risk_FEMA_FSF_v1.1.csv")
zip_risk
```
<br>

Next, import data about each zip code in the US uing the tidycensus package
``` {r echo=TRUE, message=FALSE}
library(tidycensus)
census_api_key("0a473d1b1e161d8f87da3ad85e59af583f28f1d6")

# Variable codes found here: 
# https://api.census.gov/data/2010/dec/sf1/variables.html
# P013001: MEDIAN AGE
# H006001: TOTAL ALL RACES IN HOUSEHOLD
# H006002: TOTAL HOUSEHOLDER WHITE ALONE
# H006003: TOTAL BLACK/AFRICAN-AMERICAN ALONE
zip_dem_data <- get_decennial(geography = "zcta",
                          variables = c(median_age = "P013001", 
                                        total_pop = "H006001", 
                                        total_white = "H006002", 
                                        total_black = "H006003"),
                          year = 2010,
                          output = "wide")

zip_income_data <- get_acs(geography = "zcta",
                           variables = c(median_income = "B19013_001"),
                           year = 2018,
                           output = "wide")
```
<br>

Finally, merge the the data by zip code
``` {r echo=TRUE}
merged <- inner_join(zip_dem_data, zip_risk, by = c("GEOID" = "zcta5ce")) %>%
  inner_join(zip_income_data, by = "GEOID") %>%
  select(-NAME.y) %>%
  mutate(prop_white = total_white/total_pop,
         prop_black = total_black/total_pop)

merged
```
### Preliminary Data Exploration

Questions to answer:<br>
1) Are communities that are poorer at higher risk of flooding?
2) What is the racial makeup of high-risk communities? Are certain groups disproportionately affected?
3) Where does the FEMA data disagree most with the private data? Are there any patterns? Where were the increases and decreases?

Graph how average risk score correlates with median income
``` {r echo = TRUE}
merged %>%
  ggplot(mapping = aes(x = median_incomeE,
                       y = avg_risk_score_all)) +
  geom_point()
```

Graph of FEMA under/overestimate with FSF data
``` {r echo=TRUE}
merged %>%
  ggplot(mapping = aes(x = median_incomeE,
                       y = pct_fs_fema_difference_2020)) +
  geom_point()
```
<br>


